<!-- tpl:insert page="/incubator/security/equinox.htpl" --><!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
<title>Equinox Security Home</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<style type="text/css">
.input {background: "#ffffcc";color: "#000000" ;font-weight: normal;}
a.nav:link { text-decoration: none; color: "#000000"; }
a.nav:visited { text-decoration: none; color: "#000000"; }
a.nav:hover { text-decoration: underline; color: "#000000"; }
</style>
<link rel="stylesheet" href="http://www.eclipse.org/nav_style.css" type="text/css">
<link rel="stylesheet2" href="http://eclipse.org/default_style.css" type="text/css">
</head>
<body bgcolor="#ffffff" link="#0000ee" vlink="#551a8b" alink="#ff0000" leftmargin="0" marginheight="0" topmargin="0" rightmargin="0">
<!--  start of banner  -->
 <table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" >
  <tr>
   <td WIDTH="100%">
    <table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" BGCOLOR="#006699" >

     <tr>
          <td BGCOLOR="#000000" width="116" ><a href="http://www.eclipse.org" target="_top"><img src="http://www.eclipse.org/images/EclipseBannerPic.jpg" width="115" height="50" border="0"></a></td>
          <td WIDTH="637"><img SRC="http://www.eclipse.org/images/gradient.jpg" BORDER=0 height=50 width=282></td>
          <td WIDTH="250" nowrap><img SRC="http://dev.eclipse.org/viewcvs/indextech.cgi/~checkout~/equinox-home/security/EJS/icons/eclipse-org-security-small.GIF" width="250" height="48"> </td>
     </tr>
    </table>
   </td>
  </tr>
 </table><!--  end of banner -->
<!--  start of main frame table -->
<table BORDER=0 CELLSPACING=0 CELLPADDING="4" WIDTH="100%" HEIGHT="100%" BGCOLOR="#90C8FF">
<tr><td width="160" valign="top" bgcolor="#6699CC" nowrap>
<!--  start of navigator -->
<table BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=1 WIDTH="100%"  BGCOLOR="#90C8FF" >
<tr><td>
	<table BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=1 WIDTH="100%"  BGCOLOR="#90C8FF" >
	  <tr> 
	    <td VALIGN=CENTER HEIGHT="21" BGCOLOR="#0080C0">&nbsp; <a href="http://www.eclipse.org/equinox" target="_top" class="navhead"> 
	      equinox home</a></td>
	  </tr>
	  <tr> 
	    <td BGCOLOR="#CFFFFF"><img SRC="http://www.eclipse.org/images/c.gif" height=1 width=1></td>
	  </tr>
	  <tr VALIGN=CENTER> 
	    <td HEIGHT="21">&nbsp; <a name="overview" href="http://www.eclipse.org/equinox/incubator/security/index.html" class="nav" >overview</a></td>
	  </tr>
	  <tr> 
	    <td BGCOLOR="#CFFFFF"><img SRC="http://www.eclipse.org/images/c.gif" height=1 width=1></td>
	  </tr>
	  <tr VALIGN=CENTER WIDTH="40"> 
	    <td WIDTH="40" HEIGHT="21">&nbsp; <a href="http://www.eclipse.org/equinox/incubator/security/EJS/ejs.html" class="nav">rcp plug-in analysis</a></td>
	  </tr>
	  <tr> 
	    <td BGCOLOR="#CFFFFF"><img SRC="http://www.eclipse.org/images/c.gif" height=1 width=1></td>
	  </tr>
	  <tr VALIGN=CENTER WIDTH="40"> 
	    <td WIDTH="40" HEIGHT="21">&nbsp; <a href="http://www.eclipse.org/equinox/incubator/security/java2security.html" class="nav" >java2 security</a></td>
	  </tr>
	  <tr> 
	    <td BGCOLOR="#CFFFFF"><img SRC="http://www.eclipse.org/images/c.gif" height=1 width=1></td>
	  </tr>
	  <tr VALIGN=CENTER WIDTH="40"> 
	    <td WIDTH="40" HEIGHT="21">&nbsp; <a href="http://www.eclipse.org/equinox/incubator/security/Signing.html" class="nav" >plug-in signing</a></td>
	  </tr>

	  <tr> 
	    <td BGCOLOR="#CFFFFF"><img SRC="http://www.eclipse.org/images/c.gif" height=1 width=1></td>
	  </tr>
	  <tr VALIGN=CENTER WIDTH="40"> 
	    <td WIDTH="40" HEIGHT="21">&nbsp; <a href="http://www.eclipse.org/equinox/incubator/security/EJS/rcp/keystore.html" class="nav" >keystore/credentialstore</a></td>
	  </tr>

	  <tr> 
	    <td BGCOLOR="#CFFFFF"><img SRC="http://www.eclipse.org/images/c.gif" height=1 width=1></td>
	  </tr>
	  <tr VALIGN=CENTER WIDTH="40"> 
	    <td WIDTH="40" HEIGHT="21">&nbsp; <a href="http://www.eclipse.org/equinox/incubator/security/EJS/rcp/end2end.html" class="nav" >end to end security</a></td>
	  </tr>
	  <tr> 
	    <td BGCOLOR="#CFFFFF"><img SRC="http://www.eclipse.org/images/c.gif" height=1 width=1></td>
	  </tr>
	  <tr VALIGN=CENTER WIDTH="40"> 
	    <td WIDTH="40" HEIGHT="21">&nbsp; <a href="http://www.eclipse.org/equinox/incubator/security/verifier.html" class="nav" >verifying JAR files</a></td>
	  </tr>
	  <tr> 
	    <td BGCOLOR="#CFFFFF"><img SRC="http://www.eclipse.org/images/c.gif" height=1 width=1></td>
	  </tr>
	  <tr VALIGN=CENTER WIDTH="40"> 
	    <td WIDTH="40" HEIGHT="21">&nbsp; <a href="http://www.eclipse.org/equinox/incubator/security/documents/index.html" class="nav" >documents</a></td>
	  </tr>
	  <tr> 
	    <td BGCOLOR="#CFFFFF"><img SRC="http://www.eclipse.org/images/c.gif" height=1 width=1></td>
	  </tr>
	  <tr VALIGN=CENTER WIDTH="40"> 
	    <td WIDTH="40" HEIGHT="21">&nbsp; <a href="http://www.eclipse.org/equinox/incubator/security/downloads.html" class="nav" >downloads</a></td>
	  </tr>

	</table>
</td></tr>
</table>
<!--  end of navigator -->
</td>
<!--  start of main content  -->
<td bgcolor="white" valign="top" >
<!-- tpl:put name="bodyarea" -->
<P></P><H1>PlatformURLBaseConnection.java changes</H1>
<B>Detail</B><BR><BR>
<BR><BR>
<B>DoPrivilegedLocation:</B>
<PRE>
 Line# 45 java.net.URL resolve(  )
   Permission: java.lang.RuntimePermission "getClassLoader"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.lang.RuntimePermission "modifyThread"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.net.NetPermission "specifyStreamHandler"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.net.SocketPermission "", "resolve"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.net.SocketPermission ":???port???", "connect"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.net.SocketPermission "???host???", "resolve"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.net.SocketPermission "???host???:???port???", "connect"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.net.SocketPermission "localhost", "resolve"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.net.SocketPermission "localhost:1024-", "resolve"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.net.SocketPermission "localhost:1024-:???port???", "connect"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.net.SocketPermission "localhost:???port???", "connect"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.util.PropertyPermission "*", "read,write"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: java.util.PropertyPermission "java.protocol.handler.pkgs", "read"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: org.osgi.framework.ServicePermission "", ""
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: org.osgi.framework.ServicePermission "", "get"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: org.osgi.framework.ServicePermission "java.net.ContentHandler", ""
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: org.osgi.framework.ServicePermission "java.net.ContentHandler", "get"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: org.osgi.framework.ServicePermission "org.osgi.service.url.URLStreamHandlerService", ""
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
   Permission: org.osgi.framework.ServicePermission "org.osgi.service.url.URLStreamHandlerService", "get"
      Primordial/void java.net.URL.&LT init &GT( java.net.URL, java.lang.String )
         PARAMETER #1 OF THIS METHOD CALL IS TAINTED
</PRE>
<B>CODE:</B>
<CODE>
<PRE>
17. /**
    18.  * Platform URL support
    19.  * platform:/base/	maps to platform installation location
    20.  */
    21. public class PlatformURLBaseConnection extends PlatformURLConnection {
    22. 
    23. 	// platform/ protocol
    24. 	public static final String PLATFORM = "base"; //$NON-NLS-1$
    25. 	public static final String PLATFORM_URL_STRING = PlatformURLHandler.PROTOCOL + PlatformURLHandler.PROTOCOL_SEPARATOR + "/" + PLATFORM + "/"; //$NON-NLS-1$ //$NON-NLS-2$
    26. 
    27. 	private static URL installURL;
    28. 
    29. 	public PlatformURLBaseConnection(URL url) {
    30. 		super(url);
    31. 	}
    32. 
    33. 	protected boolean allowCaching() {
    34. 		return true;
    35. 	}
    36. 
    37. 	protected URL resolve() throws IOException {
    38. 		String spec = url.getFile().trim();
    39. 		if (spec.startsWith("/")) //$NON-NLS-1$
    40. 			spec = spec.substring(1);
    41. 		if (!spec.startsWith(PLATFORM + "/")) { //$NON-NLS-1$
    42. 			String message = Policy.bind("url.badVariant", url.toString()); //$NON-NLS-1$
    43. 			throw new IOException(message);
    44. 		}
    45. 		<FONT style="background-color:yellow;display;inline">return spec.length() == PLATFORM.length() + 1 ? installURL : new URL(installURL, spec.substring(PLATFORM.length() + 1));</FONT>
    46. 	}
    47. 
    48. 	public static void startup(URL url) {
    49. 		// register connection type for platform:/base/ handling
    50. 		if (installURL != null)
    51. 			return;
    52. 		installURL = url;
    53. 		PlatformURLHandler.register(PLATFORM, PlatformURLBaseConnection.class);
    54. 	}
    55. }

</PRE>
</CODE>
<TABLE border="2">
<TR><TD bgcolor="silver">Class/method</TD><TD bgcolor="silver">Package</TD><TD bgcolor="silver">Analysis</TD></TR>
<TR><TD><PRE>PlatformURLBaseConnection.resolve()</PRE></TD><TD>org.eclipse.core.internal.boot</TD><TD> Internal, and tainted.</TD></TR>
</TABLE>
<BR><BR>
<B>Tainted variable reference trace:</B> Both the installURL, and url parameters are tainted. The only reference to the
static PlatformURLBaseConnection.startup() method is in PlatformActivator.java.  However, 
since this method's static interface is public, it can be called by any class which can
load it.   Plugin-dependency viewer shows that the class is accessable and visable.<BR><BR>
<B>Permission requirements:</B><BR>
<UL>
<LI>permission java.lang.RuntimePermission "getClassLoader"</LI>
<LI>permission java.lang.RuntimePermission "modifyThread"</LI>
<LI>permission java.net.NetPermission "specifyStreamHandler"</LI>
<LI>permission java.net.SocketPermission "*", "resolve,connect"</LI>
<LI>permission java.util.PropertyPermission "*", "read,write"</LI>
<LI>permission org.osgi.framework.ServicePermission "java.net.ContentHandler", ""</LI>
<LI>permission org.osgi.framework.ServicePermission "java.net.ContentHandler", "get"</LI>
<LI>permission org.osgi.framework.ServicePermission "", ""</LI>
<LI>permission org.osgi.framework.ServicePermission "", "get"</LI>
<LI>permission org.osgi.framework.ServicePermission "org.osgi.service.url.URLStreamHandlerService", ""</LI>
<LI>permission org.osgi.framework.ServicePermission "org.osgi.service.url.URLStreamHandlerService", "get"</LI>
</UL>
<BR>
<B>Conclusion:</B>  Do not wrap this method in a doPrivileged action.  Grant the required permissions to runtime.jar.
<BR><BR>
<!-- /tpl:put -->
<!--  end of main content -->
</td>
</tr>
</table>
<!--  end of main frame table -->
</body>
</html>

<!-- /tpl:insert -->