<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Permission Analysis Report</title>
  <script language="javaScript" src="linkUtil.js"></script>
</head>
<body>
<h1>Permission Analysis Report</h1>
<br>
<h2>Analysis of: org.eclipse.swt.win32.win32.x86</h2>
<b>Detail</b><br>
<br>
<pre>
Class: <a href="foo"
 onclick="return openURLinSrc( 'Application/org/eclipse/swt/ole/win32/OleClientSite.html' )">org.eclipse.swt.ole.win32.OleClientSite</a> (Application)<br>DoPrivileged location: <a
 href="foo"
 onclick='return openURLinFrame( "Application/org/eclipse/swt/ole/win32/OleClientSite.html#L329" , parent.fbot ); return false'>Line# 334</a> void &lt;init&gt;( org.eclipse.swt.widgets.Composite, int, java.lang.String, java.io.File )<br>   Permission: java.io.FilePermission "???file???", "read"<br>      Primordial/void java.io.FileInputStream.FileInputStream( java.io.File )<br><br><br><b>CODE</b><br><br>public OleClientSite(Composite parent, int style, String progId, File file) {<br>	this(parent, style);<br>	try {<br>		if (file == null || file.isDirectory() || !file.exists()) OLE.error(OLE.ERROR_INVALID_ARGUMENT);				<br>		appClsid = getClassID(progId);<br>		<br>		// Are we opening this file with the preferred OLE object?<br>		char[] fileName = (file.getAbsolutePath()+"\0").toCharArray();<br>		GUID fileClsid = new GUID();<br>		COM.GetClassFile(fileName, fileClsid);<br>	<br>		if (COM.IsEqualGUID(appClsid, fileClsid)){<br>			// Using the same application that created file, therefore, use default mechanism.<br>			tempStorage = createTempStorage();<br>			// Create ole object with storage object<br>			int[] address = new int[1];<br>			int result = COM.OleCreateFromFile(appClsid, fileName, COM.IIDIUnknown, COM.OLERENDER_DRAW, null, 0, tempStorage.getAddress(), address);<br>			if (result != COM.S_OK) OLE.error(OLE.ERROR_CANNOT_CREATE_OBJECT, result);<br>			objIUnknown = new IUnknown(address[0]);<br>		} else {<br>			// Not using the same application that created file, therefore, copy from original file to a new storage file<br>			IStorage storage = null;<br>			if (COM.StgIsStorageFile(fileName) == COM.S_OK) {<br>				int[] address = new int[1];<br>				int mode = COM.STGM_READ | COM.STGM_TRANSACTED | COM.STGM_SHARE_EXCLUSIVE;<br>				int result = COM.StgOpenStorage(fileName, 0, mode, 0, 0, address); //Does an AddRef if successful<br>				if (result != COM.S_OK) OLE.error(OLE.ERROR_CANNOT_OPEN_FILE, result);<br>				storage = new IStorage(address[0]);<br>			} else {<br>				// Original file is not a Storage file so copy contents to a stream in a new storage file<br>				int[] address = new int[1];<br>				int mode = COM.STGM_READWRITE | COM.STGM_DIRECT | COM.STGM_SHARE_EXCLUSIVE | COM.STGM_CREATE;<br>				int result = COM.StgCreateDocfile(null, mode | COM.STGM_DELETEONRELEASE, 0, address); // Increments ref count if successful<br>				if (result != COM.S_OK) OLE.error(OLE.ERROR_CANNOT_OPEN_FILE, result);<br>				storage = new IStorage(address[0]);<br>				// Create a stream on the storage object.<br>				// Word does not follow the standard and does not use "CONTENTS" as the name of<br>				// its primary stream<br>				String streamName = "CONTENTS"; //$NON-NLS-1$<br>				GUID wordGUID = getClassID(WORDPROGID);<br>				if (COM.IsEqualGUID(appClsid, wordGUID)) streamName = "WordDocument"; //$NON-NLS-1$<br>				address = new int[1];<br>				result = storage.CreateStream(streamName, mode, 0, 0, address); // Increments ref count if successful<br>				if (result != COM.S_OK) {<br>					storage.Release();<br>					OLE.error(OLE.ERROR_CANNOT_OPEN_FILE, result);<br>				}<br>				IStream stream = new IStream(address[0]);<br>				try {<br>					// Copy over data in file to named stream<br><span
 style="color: rgb(255, 0, 0);">					FileInputStream fileInput = new FileInputStream(file);</span><br>					int increment = 1024*4;<br>					byte[] buffer = new byte[increment];<br>					int count = 0;<br>					while((count = fileInput.read(buffer)) &gt; 0){<br>						int pv = COM.CoTaskMemAlloc(count);<br>						OS.MoveMemory(pv, buffer, count);<br>						result = stream.Write(pv, count, null) ;<br>						COM.CoTaskMemFree(pv);<br>						if (result != COM.S_OK) {<br>							fileInput.close();<br>							stream.Release();<br>							storage.Release();<br>							OLE.error(OLE.ERROR_CANNOT_OPEN_FILE, result);<br>						}<br>					}<br>					fileInput.close();<br>					stream.Commit(COM.STGC_DEFAULT);<br>					stream.Release();<br>				} catch (IOException err) {<br>					stream.Release();<br>					storage.Release();<br>					OLE.error(OLE.ERROR_CANNOT_OPEN_FILE);<br>				}<br>			}<br>			<br>			// Open a temporary storage object<br>			tempStorage = createTempStorage();<br>			// Copy over contents of file<br>			int result = storage.CopyTo(0, null, null, tempStorage.getAddress());<br>			storage.Release();<br>			if (result != COM.S_OK) OLE.error(OLE.ERROR_CANNOT_OPEN_FILE, result);<br><br>			// create ole client<br>			int[] ppv = new int[1];<br>			result = COM.CoCreateInstance(appClsid, 0, COM.CLSCTX_INPROC_HANDLER | COM.CLSCTX_INPROC_SERVER, COM.IIDIUnknown, ppv);<br>			if (result != COM.S_OK) OLE.error(OLE.ERROR_CANNOT_CREATE_OBJECT, result);<br>			objIUnknown = new IUnknown(ppv[0]);<br>			// get the persistant storage of the ole client<br>			ppv = new int[1];<br>			result = objIUnknown.QueryInterface(COM.IIDIPersistStorage, ppv);<br>			if (result != COM.S_OK) OLE.error(OLE.ERROR_CANNOT_CREATE_OBJECT, result);<br>			IPersistStorage iPersistStorage = new IPersistStorage(ppv[0]);<br>			// load the contents of the file into the ole client site<br>			result = iPersistStorage.Load(tempStorage.getAddress());<br>			iPersistStorage.Release();<br>			if (result != COM.S_OK)OLE.error(OLE.ERROR_CANNOT_CREATE_OBJECT, result);<br>		}<br>		<br>		// Init sinks<br>		addObjectReferences();<br>		<br>		if (COM.OleRun(objIUnknown.getAddress()) == OLE.S_OK) state = STATE_RUNNING;<br>		<br>	} catch (SWTException e) {<br>		dispose();<br>		disposeCOMInterfaces();<br>		throw e;<br>	}<br>}<br><br>
<b>Tainted variable reference trace:</b><br><br>
<b>Permission Requirements:</b><br><br><ul>
<li>permission java.io.FilePermission "???file???", "read";</li>
</ul><br><br>
<b>Conclusion:</b><br><br><br>The file variable is passed in as a method parameter. <br><br>Grant the permission to this plug-in via OSGI-INF/permissions.perm file.<br><hr>
DoPrivileged location: <a
 href="foo"
 onclick='return openURLinFrame( "Application/org/eclipse/swt/ole/win32/OleClientSite.html#L1075" , parent.fbot ); return false'>Line# 1080</a> boolean saveFromContents( int, java.io.File )<br>   Permission: java.io.FilePermission "???file???", "write"<br>      Primordial/void java.io.FileOutputStream.FileOutputStream( java.io.File )<br><br><br><b>CODE</b><br><br>private boolean saveFromContents(int address, File file) {<br><br>	boolean success = false;<br>	<br>	IStream tempContents = new IStream(address);<br>	tempContents.AddRef();<br><br>	try {<br><span
 style="color: rgb(255, 0, 0);">		FileOutputStream writer = new FileOutputStream(file);</span><br>		<br>		int increment = 1024 * 4;<br>		int pv = COM.CoTaskMemAlloc(increment);<br>		int[] pcbWritten = new int[1];<br>		while (tempContents.Read(pv, increment, pcbWritten) == COM.S_OK &amp;&amp; pcbWritten[0] &gt; 0) {<br>			byte[] buffer = new byte[ pcbWritten[0]];<br>			OS.MoveMemory(buffer, pv, pcbWritten[0]);<br>			writer.write(buffer); // Note: if file does not exist, this will create the file the <br>			                      // first time it is called<br>			success = true;<br>		}<br>		COM.CoTaskMemFree(pv);<br>			<br>		writer.close();<br>		<br>	} catch (IOException err) {<br>	}<br><br>	tempContents.Release();<br><br>	return success;<br>}<br><br>
<b>Tainted variable reference trace:</b><br><br>
<b>Permission Requirements:</b><br><br><ul>
<li>permission java.io.FilePermission "???file???", "write";</li>
</ul><br><br>
<b>Conclusion:</b><br><br>The caller require the permission on the file varible it passes in.<br><br>Grant the permission to this plug-in via OSGI-INF/permissions.perm file.<br><hr>
DoPrivileged location: <a
 href="foo"
 onclick='return openURLinFrame( "Application/org/eclipse/swt/ole/win32/OleClientSite.html#L1123" , parent.fbot ); return false'>Line# 1128</a> boolean saveFromOle10Native( int, java.io.File )<br>   Permission: java.io.FilePermission "???file???", "write"<br>      Primordial/void java.io.FileOutputStream.FileOutputStream( java.io.File )<br><br><br><b>CODE</b><br><br>private boolean saveFromOle10Native(int address, File file) {<br><br>	boolean success = false;<br>	<br>	IStream tempContents = new IStream(address);<br>	tempContents.AddRef();<br>	<br>	// The "\1Ole10Native" stream contains a DWORD header whose value is the length <br>	// of the native data that follows.<br>	int pv = COM.CoTaskMemAlloc(4);<br>	int[] size = new int[1];<br>	int rc = tempContents.Read(pv, 4, null);<br>	OS.MoveMemory(size, pv, 4);<br>	COM.CoTaskMemFree(pv);<br>	if (rc == COM.S_OK &amp;&amp; size[0] &gt; 0) {<br>		<br>		// Read the data<br>		byte[] buffer = new byte[size[0]];<br>		pv = COM.CoTaskMemAlloc(size[0]);<br>		rc = tempContents.Read(pv, size[0], null);<br>		OS.MoveMemory(buffer, pv, size[0]);<br>		COM.CoTaskMemFree(pv);<br><br>		// open the file and write data into it<br>		try {<br><span
 style="color: rgb(255, 0, 0);">			FileOutputStream writer = new FileOutputStream(file);</span><br>			writer.write(buffer); // Note: if file does not exist, this will create the file<br>			writer.close();<br><br>			success = true;<br>		} catch (IOException err) {<br>		}<br>	}<br>	tempContents.Release();<br><br>	return success;<br>}<br>
<b>Tainted variable reference trace:</b><br><br>
<b>Permission Requirements:</b><br><br><ul>
<li>permission java.io.FilePermission "???file???", "write";</li>
</ul><br><br>
<b>Conclusion:</b><br><br>The caller require the permission on the file varible it passes in.<br><br>Grant the permission to this plug-in via OSGI-INF/permissions.perm file.<br><hr>
</pre>
</body>
</html>
