<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>The Equinox Project - Dynamic plugins</title>
<link rel="stylesheet" title="default" href="http://eclipse.org/default_style.css" type="text/css">
</head>
<body>
<table BORDER=0 CELLSPACING=5 CELLPADDING=2 WIDTH="100%" >
  <tr> 
    <td ALIGN=left width="60%">
      <p><font class=indextop> equinox</font><br>
        <font class=indexsub> dynamic plugins > deactivating plugins</font> </p>
    </td>
    <td WIDTH="40%">&nbsp; </td>
  </tr>
</table>
Deactivating plugins is the act of moving an activated plugin to deactivated state.  This does not remove it from the registry but runs the plugin's shutdown lifecycle and returns the plugin to the same state as it was before it was activated (i.e., when the platform started).  All extensions and extension-points remain in place.
<p />
There are two reasons for deactivating a plugin:
<ol>
<li> regain some space by removing any structures required by the plugin and recovering the space required for its classes.
</li>
<li> as a prelude to removing the plugin from the registry.
</li>
</ol>
<p />
Deactivating does not itself require additional lifecycle but does require that any plugins dependent on the plugin being deactivated also be deactivated.  This transitive deactivation must be done in dependent order (i.e., dependents first).
<p />
Chances are that the plugins are not very good about cleaning up after themselves.  A plugin that is being shutdown should clean up its internals to limit the number of external references it might have.  However, it is often the case that other plugins have references to instances of the deactivated plugin's classes.  This will prevent those classes and thus the plugin's classloader from being garbage collected.
<p />
One simple approach that can be implemented in the Eclipse runtime infrastructure is to manage instances created via createExecutableExtension().  This is the method used to create instances of classes provided via extensions to extension-points.  Since this code path goes through runtime code, the runtime could track instances created and at report on plugins which retain references after a plugin is deactivated.
<p />
In the end however, it is likely that additional lifecycle events will have to be added so that referencing plugins can be signalled that it is time to clean up.
<p />
<p />
<table BORDER=0 CELLSPACING=5 CELLPADDING=2 WIDTH="100%" >
  <tr> 
    <td ALIGN=LEFT VALIGN=TOP COLSPAN="2" BGCOLOR="#0080C0"><b><font color="#FFFFFF"> 
      Questions:</font></b></td>
  </tr>
</table>
 <ul>
   <li>Beside the instances created through createExecutableExtension(), who should collect the other instances?</li>
   <li>As a matter of example, which plugin is supposed to close the views: the UI plugin, or the plugin providing the view?</li>
   <li>Does a generic scheme to collect the instance exists?</li>
 </ul>
</body>
</html>